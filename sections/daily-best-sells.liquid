{% stylesheet %}
  .daily-best-sells .swiper-button-prev {
    position: absolute;
    left: -60px !important;
    top: 50%;
    transform: translateY(-50%);
    width: 44px;
    height: 44px;
  }
  .daily-best-sells .swiper-button-next {
    position: absolute;
    right: -60px !important;
    top: 50%;
    transform: translateY(-50%);
    width: 44px;
    height: 44px;
  }

  .swiper-button-next:after,
  .swiper-button-prev:after {
    font-size: 15px;
    color: #65a241;
  }
  .swiper-button-next:hover:after,
  .swiper-button-prev:hover:after {
    color: #fff;
  }

  .daily-best-sells .swiper-slide {
    height: auto !important;
  }
  .daily-best-sells .swiper-slide > div {
    height: 100%;
  }

  @media (max-width: 768px) {
    .daily-best-sells .swiper-button-prev,
    .daily-best-sells .swiper-button-next {
      display: none;
    }
  }
{% endstylesheet %}

<div class="daily-best-sells relative">
  <div class="relative container">
    <h2 class="text-2xl lg:text-[32px] font-bold text-heading mb-4 lg:mb-6">{{ section.settings.section_title }}</h2>
    <div class="swiper daily-best-sells-slider">
      <div class="swiper-wrapper">

        {% assign product_collection = collections[section.settings.collection] | default: collections.all %}
        {% assign max_products = 8 %}
        
        {% for product in product_collection.products limit: max_products %}
          <div class="swiper-slide">
            <div class="flex flex-col justify-between border border-[#ECECEC] rounded-lg lg:rounded-[15px] p-4 lg:p-5 relative z-1 h-full">
              {% if section.settings.show_hot_tag %}
                <span class="tag absolute left-0 top-0 rounded-[0_0_8px_0] lg:rounded-[0_0_14px_0] bg-[#F74B81] text-sm text-white h-7.5 w-15 capitalize flex items-center justify-center">
                  hot
                </span>
              {% endif %}
              
              {% if product.featured_image %}
                <img 
                  src="{{ product.featured_image | img_url: '400x400' }}" 
                  class="size-50 lg:size-56.5 mx-auto" 
                  width="400" 
                  height="400" 
                  alt="{{ product.featured_image.alt | escape }}"
                  loading="lazy"
                >
              {% else %}
                {{ 'product-1' | placeholder_svg_tag: 'size-50 lg:size-56.5 mx-auto' }}
              {% endif %}

              <div class="mt-1">
                <span class="collection block text-sm text-gray mb-1">{{ product.type }}</span>
                <h2 class="title text-base md:text-lg text-subheading mb-2.5">
                  <a href="{{ product.url }}">{{ product.title }}</a>
                </h2>
                
                {% if product.metafields.reviews.rating.value %}
                  <div class="flex items-center gap-10 lg:gap-12 mb-1.5">
                    <div class="flex items-center gap-1">
                      {% for i in (1..5) %}
                        <svg
                          class="size-3 {% if i <= product.metafields.reviews.rating.value %}text-yellow-400{% else %}text-gray-300{% endif %}"
                          fill="currentColor"
                          viewBox="0 0 20 20"
                        >
                          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                      {% endfor %}
                    </div>
                    <p class="review-count text-sm md:text-base text-gray">
                      ({{ product.metafields.reviews.rating_count.value | default: 0 }})
                    </p>
                  </div>
                {% endif %}
                
                <div class="flex items-center gap-2.5">
                  <p class="sell-price text-lg lg:text-xl font-bold text-secondary">
                    {{ product.price | money }}
                  </p>
                  {% if product.compare_at_price > product.price %}
                    <p class="old-price text-sm lg:text-base font-bold text-gray line-through">
                      {{ product.compare_at_price | money }}
                    </p>
                  {% endif %}
                </div>
                
                {% if section.settings.show_sold_progress %}
                  <div class="mt-3 lg:mt-4">
                    <div class="h-1.5 w-full rounded-full bg-[#E9ECEF]">
                      <div class="h-full rounded-full w-[35%] bg-primary"></div>
                    </div>
                    <p class="sold mt-2 text-sm md:text-base text-heading flex items-center gap-1 font-semibold">
                      Sold <span>90/120</span>
                    </p>
                  </div>
                {% endif %}
                
                <button
                  class="btn add-card-btn flex items-center gap-0.5 mt-4 lg:mt-5 min-w-full!"
                  onclick="addToCart({{ product.variants.first.id }})"
                >
                 Add To Cart
                </button>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      <div class="swiper-pagination hidden"></div>
    </div>

    <div class="swiper-button-prev bg-white border border-solid border-[#F0F0F0] hover:bg-[#2E2E2E] transition-all duration-300 rounded-full w-11 h-11 flex items-center justify-center shadow"></div>
    <div class="swiper-button-next bg-white border border-solid border-[#F0F0F0] hover:bg-[#2E2E2E] transition-all duration-300 rounded-full w-11 h-11 flex items-center justify-center shadow"></div>
  </div>
</div>

{% javascript %}
  const swiper = new Swiper('.daily-best-sells-slider', {
    slidesPerView: 1,
    spaceBetween: 16,
    pagination: { el: '.swiper-pagination', clickable: true },
    navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
    breakpoints: {
      320: { slidesPerView: 1, spaceBetween: 16 },
      768: { slidesPerView: 2, spaceBetween: 20 },
      992: { slidesPerView: 3, spaceBetween: 24 },
      1220: { slidesPerView: 4, spaceBetween: 24 },
    },
  });
{% endjavascript %}

{% schema %}
{
  "name": "Daily Best Sells",
  "settings": [
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Daily Best Sells"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Product Collection",
      "info": "Select a collection to display products from. Leave empty to show from all products."
    },
    {
      "type": "checkbox",
      "id": "show_hot_tag",
      "label": "Show Hot Tag",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_sold_progress",
      "label": "Show Sold Progress Bar",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Daily Best Sells"
    }
  ]
}
{% endschema %}